<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js' type='text/javascript'></script>
    <title>Alert</title>
</head>

<body>

    <script>
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const socketToken = urlParams.get ('token');
        const streamlabs = io(`https://sockets.streamlabs.com?token=${socketToken}`, { transports: ['websocket'] });
        streamlabs.on('event', (eventData) => {
            if (eventData.for === "youtube_account") {
                switch (eventData.type) {
                    case "subscription":
                        callAlert(eventData.message[0].name, eventData.message[0].message, "", "bg-emerald-500");
                        break;
                    case "superchat":
                        callAlert(eventData.message[0].name, eventData.message[0].comment, eventData.message[0].displayString, "bg-red-500");
                        break;
                }
            }
        });

        const throttle = (fn, delay) => {
            let timeout;
            let noDelay = true;
            let queue = [];
            const start = () => {
                if (queue.length) {
                    const first = queue.shift();
                    fn.apply(first.context, first.arguments);
                    timeout = setTimeout(start, delay);
                } else {
                    noDelay = true;
                }
            };

            const ret = (...rest) => {
                queue.push({
                    context: this,
                    arguments: [...rest]
                });
                if (noDelay) {
                    noDelay = false;
                    start();
                }
            };

            ret.reset = () => {
                clearTimeout(timeout);
                queue = [];
            };
            return ret;
        };

        var callAlert = throttle(onAlert, 8000);

        function onAlert(name, message, nominal, bgColor) {
            var content = document.getElementById("content");
            content.innerHTML = `
      <div id="content-alert" class="flex ${bgColor} m-2 p-2 w-100 max-w-screen-sm h-auto rounded-lg slide-right">
        <div class="flex-1 w-24">
          <svg class="slideLeft" width="100" height="80" viewBox="0 0 auto auto">
            <symbol id="s-text">
              <text text-anchor="middle" x="50%" y="90%">4L</text>
            </symbol>

            <g class="g-ants">
              <use xlink:href="#s-text" class="text-copy"></use>
              <use xlink:href="#s-text" class="text-copy"></use>
              <use xlink:href="#s-text" class="text-copy"></use>
              <use xlink:href="#s-text" class="text-copy"></use>
              <use xlink:href="#s-text" class="text-copy"></use>
            </g>
          </svg>
        </div>
        <div class="flex-auto pl-5">
          <h1 class='slideTop text-teal-50 text-2xl'>${name}</h1>
          <p class="slideLeft text-teal-100">${message}</p>
        </div>
        <div class="flex-auto pl-5">
          <h1 class='slideTop text-teal-50 text-2xl text-red-50 text-center'>${nominal}</h1>
        </div>
      </div>
      `;
            var contentAlert = document.getElementById("content-alert");
            setTimeout(() => {
                contentAlert.className = `flex ${bgColor} m-2 p-2 w-100 max-w-screen-sm h-auto rounded-lg slide-left`;
            }, 2000);
            setTimeout(() => {
                content.innerHTML = "";
            }, 8000)
        }
    </script>
    <div id="content">

    </div>
    <style>
        @import url(https://fonts.googleapis.com/css?family=Montserrat);

        body {
            background-color: rgba(0, 0, 0, 0);
            font-family: Arial;
        }

        svg {
            display: block;
            font: 5.5em 'Montserrat';

            margin: 0 auto;
        }

        .text-copy {
            fill: none;
            stroke: white;
            stroke-dasharray: 6% 29%;
            stroke-width: 5px;
            stroke-dashoffset: 0%;
            animation: stroke-offset 5.5s infinite linear;
        }

        .text-copy:nth-child(1) {
            stroke: #4D163D;
            animation-delay: -1;
        }

        .text-copy:nth-child(2) {
            stroke: #840037;
            animation-delay: -2s;
        }

        .text-copy:nth-child(3) {
            stroke: #BD0034;
            animation-delay: -3s;
        }

        .text-copy:nth-child(4) {
            stroke: #BD0034;
            animation-delay: -4s;
        }

        .text-copy:nth-child(5) {
            stroke: #FDB731;
            animation-delay: -5s;
        }

        @keyframes stroke-offset {
            100% {
                stroke-dashoffset: -35%;
            }
        }

        .slideTop {
            animation: 2s anim-slideTop ease-out;
        }

        .slideLeft {
            animation: 2s anim-slideLeft ease-out;
        }

        .slideRight {
            animation: 2s anim-slideRight ease-out;
        }

        @keyframes anim-slideTop {
            0% {
                opacity: 0;
                transform: translateY(80%);
            }

            20% {
                opacity: 0;
            }

            50% {
                opacity: 1;
                transform: translateY(0%);
            }

            100% {
                opacity: 1;
                transform: translateY(0%);
            }
        }

        @keyframes anim-slideLeft {
            0% {
                opacity: 0;
                transform: translateX(80%);
            }

            20% {
                opacity: 0;
            }

            50% {
                opacity: 1;
                transform: translateX(0%);
            }

            100% {
                opacity: 1;
                transform: translateX(0%);
            }
        }

        @keyframes anim-slideRight {
            0% {
                opacity: 0;
                transform: translateX(-80%);
            }

            20% {
                opacity: 0;
            }

            50% {
                opacity: 1;
                transform: translateX(0%);
            }

            100% {
                opacity: 1;
                transform: translateX(0%);
            }
        }

        .slide-left {
            animation: 2s slide-left cubic-bezier(.175, .885, .32, 1.275) 5s;
        }

        @-webkit-keyframes slide-left {
            0% {
                -webkit-transform: translateX(0);
                transform: translateX(0)
            }

            50% {
                -webkit-transform: translateX(-100px);
                transform: translateX(-100px)
            }

            100% {
                -webkit-transform: translateX(-100px);
                transform: translateX(-100px)
            }
        }

        @keyframes slide-left {
            0% {
                -webkit-transform: translateX(0);
                transform: translateX(0)
            }

            50% {
                -webkit-transform: translateX(-102%);
                transform: translateX(-102%)
            }

            100% {
                -webkit-transform: translateX(-102%);
                transform: translateX(-102%)
            }
        }

        .slide-right {
            animation: 1s slide-right cubic-bezier(.175, .885, .32, 1.275);
        }

        @-webkit-keyframes slide-right {
            100% {
                -webkit-transform: translateX(0);
                transform: translateX(0);
                opacity: 1;
            }

            0% {
                -webkit-transform: translateX(-100%);
                transform: translateX(-100%);
                opacity: 0;
            }
        }

        @keyframes slide-right {
            100% {
                -webkit-transform: translateX(0);
                transform: translateX(0);
                opacity: 1;
            }

            0% {
                -webkit-transform: translateX(-100%);
                transform: translateX(-100%);
                opacity: 0;
            }
        }
    </style> 

</body>

</html>
